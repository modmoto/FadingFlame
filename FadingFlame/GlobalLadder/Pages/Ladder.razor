@page "/Ladder"
@using MongoDB.Bson

<div>
  <h1>Fading Flame global ranking</h1>
  <div class="blockquote-footer my-3">
    You will only be ranked after playing 3 games
  </div>
  <table class="table table-striped table-hover">
    <thead>
      <th style="max-width: 3rem">Rank</th>
      <th>Name</th>
      <th>Points</th>
      <th>Wins</th>
      <th>Losses</th>
      <th>Draws</th>
      <th>Matches</th>
    </thead>
    <tbody>
    @foreach (var item in _enlistedPlayersOriginal.Select((value, index) => new {value, index}))
    {
      <tr @onclick="() => GoToPlayer(item.value.Id)" class="cursor">
        <td>@(item.index + 1).</td>
        <td>@item.value.Name</td>
        <td>@item.value.Mmr</td>
        <td class="won">@item.value.Wins</td>
        <td class="lost">@item.value.Losses</td>
        <td class="draw">@item.value.Draws</td>
        <td>@item.value.MatchCount</td>
      </tr>
    }
    </tbody>
  </table>
</div>

@inject IRankingReadmodelRepository _playerRepository
@inject NavigationManager _navigation

@code {
  private List<PlayerRankingReadModel> _enlistedPlayersOriginal = new();

  protected override async Task OnInitializedAsync()
  {
    _enlistedPlayersOriginal = await _playerRepository.LoadAllRanked();
  }

  private void GoToPlayer(ObjectId playerId)
  {
    _navigation.NavigateTo($"player/{playerId}");
  }
}