@page "/admin"
@using FadingFlame.Leagues
@using FadingFlame.UserAccounts
@using FadingFlame.Discord
@inject UserState _userState
@inject ILeagueCommandHandler _leagueCommandHandler
@inject IDiscordBot _discordBot

@if (_userState.UserIsAdmin)
{
    <button type="button" class="btn btn-primary" @onclick="CreateLeagues">Reset Season 1</button>
}

@code {

    protected override void OnInitialized()
    {
        _userState.UserLoggedIn += (_, _) => StateHasChanged();
        _userState.UserLoggedOut += (_, _) => StateHasChanged();
    }

    private async Task CreateLeagues()
    {
        if (_userState.UserIsAdmin)
        {
            var leagues = await _leagueCommandHandler.CreateLeagues();
            await _discordBot.CreateLeagueChannels(leagues);
        }
    }
}
